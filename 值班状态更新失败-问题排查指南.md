# å€¼ç­çŠ¶æ€æ›´æ–°å¤±è´¥ - é—®é¢˜æ’æŸ¥æŒ‡å—

## ğŸ› é—®é¢˜æè¿°

**ç—‡çŠ¶ï¼š** å°ç¨‹åºåˆ‡æ¢å€¼ç­çŠ¶æ€åï¼Œæ•°æ®åº“çš„ `notification_enabled` å­—æ®µæ²¡æœ‰æ›´æ–°ï¼Œä¸€ç›´æ˜¯ 1

---

## ğŸ” æ’æŸ¥æ­¥éª¤

### æ­¥éª¤1ï¼šæ£€æŸ¥å‰ç«¯æ˜¯å¦æ­£ç¡®è°ƒç”¨æ¥å£

#### 1.1 æ‰“å¼€å°ç¨‹åºæ§åˆ¶å°

åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­ï¼Œç‚¹å‡»"è°ƒè¯•å™¨" â†’ "Console"

#### 1.2 åˆ‡æ¢å€¼ç­çŠ¶æ€å¹¶è§‚å¯Ÿæ—¥å¿—

ç‚¹å‡»å¯¼èˆªæ çš„"ä¸Šå²—/ç¦»å²—"æŒ‰é’®ï¼ŒæŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼š

**åº”è¯¥çœ‹åˆ°çš„æ—¥å¿—ï¼š**
```javascript
ğŸ“‹ [å€¼ç­çŠ¶æ€] åˆå§‹åŒ–openid: oXXXXXXXXXXXXXXXXXXX  // â† è¿™ä¸ªå¾ˆé‡è¦ï¼
ğŸ“‹ [å€¼ç­çŠ¶æ€] åˆ‡æ¢å‰: å€¼ç­ä¸­
ğŸ”„ [å€¼ç­çŠ¶æ€] åˆ‡æ¢æˆåŠŸ: ç¦»å²—
```

**å…³é”®æ£€æŸ¥ç‚¹ï¼š**
- âœ… `currentUserOpenid` æ˜¯å¦æœ‰å€¼ï¼Ÿ
- âœ… æ¥å£è¯·æ±‚æ˜¯å¦å‘å‡ºï¼Ÿ
- âœ… è¿”å›çš„ `res.code` æ˜¯å¦ä¸º '0'ï¼Ÿ

#### 1.3 æ£€æŸ¥Networkè¯·æ±‚

åœ¨æ§åˆ¶å°çš„"Network"æ ‡ç­¾ä¸­æŸ¥çœ‹ï¼š

**è¯·æ±‚ä¿¡æ¯ï¼š**
```
URL: /parking/patrol/toggleNotification
Method: POST
Request Payload: {
  "openid": "oXXXXXXXXXXXXXXXXXXX",  // â† æ£€æŸ¥è¿™ä¸ªæ˜¯å¦æœ‰å€¼
  "enabled": 0
}
```

**å“åº”ä¿¡æ¯ï¼š**
```json
{
  "code": "0",
  "msg": "çŠ¶æ€å·²æ›´æ–°ä¸ºï¼šç¦»å²—",
  "data": { ... }
}
```

---

### æ­¥éª¤2ï¼šæ£€æŸ¥åç«¯æ˜¯å¦æ”¶åˆ°è¯·æ±‚

#### 2.1 æŸ¥çœ‹åç«¯æ§åˆ¶å°æ—¥å¿—

åç«¯åº”è¯¥è¾“å‡ºä»¥ä¸‹æ—¥å¿—ï¼š

**æ­£å¸¸æƒ…å†µï¼š**
```
ğŸ”„ [å€¼ç­çŠ¶æ€åˆ‡æ¢] è¯·æ±‚å‚æ•°: PatrolDutyRequest{openid='oXXXX', enabled=0}
ğŸ”„ [å€¼ç­çŠ¶æ€åˆ‡æ¢] openid: oXXXX, ç›®æ ‡çŠ¶æ€: ç¦»å²—
âœ… [å€¼ç­çŠ¶æ€åˆ‡æ¢] æˆåŠŸ - å·¡æ£€å‘˜: å¼ ä¸‰, å°åŒº: æµ‹è¯•å°åŒº, æ–°çŠ¶æ€: ç¦»å²—
```

**å¼‚å¸¸æƒ…å†µ1ï¼šæœªæ‰¾åˆ°å·¡æ£€å‘˜**
```
âš ï¸ [å€¼ç­çŠ¶æ€åˆ‡æ¢] æœªæ‰¾åˆ°å·¡æ£€å‘˜ - openid: oXXXX
```
**åŸå› ï¼š** æ•°æ®åº“ä¸­æ²¡æœ‰åŒ¹é…çš„openidè®°å½•

**å¼‚å¸¸æƒ…å†µ2ï¼šæ•°æ®åº“æ›´æ–°å¤±è´¥**
```
âŒ [å€¼ç­çŠ¶æ€åˆ‡æ¢] æ•°æ®åº“æ›´æ–°å¤±è´¥ - openid: oXXXX
```
**åŸå› ï¼š** æ•°æ®åº“æ›´æ–°è¯­å¥æ‰§è¡Œå¤±è´¥

#### 2.2 å¦‚æœæ²¡æœ‰çœ‹åˆ°ä»»ä½•æ—¥å¿—

**å¯èƒ½åŸå› ï¼š**
- âŒ æ¥å£è·¯å¾„é…ç½®é”™è¯¯
- âŒ åç«¯æœåŠ¡æœªå¯åŠ¨
- âŒ ç½‘ç»œè¯·æ±‚è¢«æ‹¦æˆª
- âŒ è·¨åŸŸé—®é¢˜

---

### æ­¥éª¤3ï¼šæ£€æŸ¥æ•°æ®åº“è¡¨ç»“æ„

#### 3.1 æ£€æŸ¥patrolè¡¨æ˜¯å¦æœ‰openidå­—æ®µ

æ‰§è¡ŒSQLæŸ¥è¯¢ï¼š
```sql
-- æŸ¥çœ‹è¡¨ç»“æ„
DESC patrol;

-- æˆ–
SHOW COLUMNS FROM patrol LIKE 'openid';
```

**åº”è¯¥çœ‹åˆ°ï¼š**
```
Field    | Type         | Null | Key | Default | Extra
---------|-------------|------|-----|---------|-------
openid   | varchar(64) | YES  |     | NULL    |
```

**å¦‚æœæ²¡æœ‰openidå­—æ®µï¼Œæ‰§è¡Œï¼š**
```sql
ALTER TABLE patrol ADD COLUMN openid VARCHAR(64) COMMENT 'å¾®ä¿¡openid';
```

#### 3.2 æ£€æŸ¥notification_enabledå­—æ®µ

```sql
SHOW COLUMNS FROM patrol LIKE 'notification_enabled';
```

**åº”è¯¥çœ‹åˆ°ï¼š**
```
Field                 | Type    | Null | Key | Default | Extra
---------------------|---------|------|-----|---------|-------
notification_enabled | int(11) | YES  |     | 1       |
```

**å¦‚æœæ²¡æœ‰è¯¥å­—æ®µï¼Œæ‰§è¡Œï¼š**
```sql
ALTER TABLE patrol ADD COLUMN notification_enabled INT DEFAULT 1 COMMENT 'æ˜¯å¦æ¥æ”¶é€šçŸ¥ï¼š1=æ˜¯ï¼Œ0=å¦';
ALTER TABLE patrol ADD COLUMN last_status_change_time DATETIME COMMENT 'æœ€åçŠ¶æ€å˜æ›´æ—¶é—´';
```

---

### æ­¥éª¤4ï¼šæ£€æŸ¥æ•°æ®åº“ä¸­çš„openidæ•°æ®

#### 4.1 æŸ¥è¯¢patrolè¡¨çš„openidæ•°æ®

```sql
SELECT id, username, usercode, openid, notification_enabled 
FROM patrol 
LIMIT 10;
```

**æ£€æŸ¥ç‚¹ï¼š**
1. âœ… openidå­—æ®µæ˜¯å¦æœ‰å€¼ï¼Ÿ
2. âœ… æ˜¯å¦ä¸å°ç¨‹åºä¸­çš„openidä¸€è‡´ï¼Ÿ
3. âœ… notification_enabledå­—æ®µæ˜¯å¦å­˜åœ¨ï¼Ÿ

**å¸¸è§é—®é¢˜ï¼š**
- âŒ openidä¸ºNULL
- âŒ openidæ ¼å¼ä¸æ­£ç¡®
- âŒ openidä¸å°ç¨‹åºä¸­çš„ä¸ä¸€è‡´

#### 4.2 æ ¹æ®å°ç¨‹åºçš„openidæŸ¥è¯¢

```sql
-- æ›¿æ¢ 'oXXXXXXXXXXXXXXXXXXX' ä¸ºå®é™…çš„openid
SELECT * FROM patrol WHERE openid = 'oXXXXXXXXXXXXXXXXXXX';
```

**å¦‚æœæŸ¥è¯¢ç»“æœä¸ºç©ºï¼š**
- è¯´æ˜æ•°æ®åº“ä¸­æ²¡æœ‰è¯¥å·¡æ£€å‘˜çš„è®°å½•
- éœ€è¦å…ˆåˆ›å»ºå·¡æ£€å‘˜è®°å½•æˆ–æ›´æ–°openid

---

### æ­¥éª¤5ï¼šæ‰‹åŠ¨æµ‹è¯•æ•°æ®åº“æ›´æ–°

#### 5.1 ç›´æ¥æ‰§è¡Œæ›´æ–°SQL

```sql
-- æµ‹è¯•æ›´æ–°ï¼ˆæ›¿æ¢ä¸ºå®é™…çš„openidï¼‰
UPDATE patrol 
SET notification_enabled = 0,
    last_status_change_time = NOW()
WHERE openid = 'oXXXXXXXXXXXXXXXXXXX';

-- æŸ¥çœ‹æ›´æ–°ç»“æœ
SELECT * FROM patrol WHERE openid = 'oXXXXXXXXXXXXXXXXXX';
```

**å¦‚æœæ‰‹åŠ¨æ›´æ–°æˆåŠŸï¼š**
- è¯´æ˜æ•°æ®åº“æ²¡é—®é¢˜
- é—®é¢˜åœ¨äºæ¥å£é€»è¾‘æˆ–æŸ¥è¯¢æ¡ä»¶

**å¦‚æœæ‰‹åŠ¨æ›´æ–°å¤±è´¥ï¼š**
- æ£€æŸ¥æ•°æ®åº“æƒé™
- æ£€æŸ¥å­—æ®µæ˜¯å¦å­˜åœ¨
- æ£€æŸ¥SQLè¯­æ³•

---

## ğŸ”§ å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

### é—®é¢˜1ï¼šopenidä¸ºç©ºæˆ–undefined

**ç—‡çŠ¶ï¼š**
```javascript
ğŸ“‹ [å€¼ç­çŠ¶æ€] åˆå§‹åŒ–openid:   // â† ç©ºå€¼
âš ï¸ [å€¼ç­çŠ¶æ€] openidä¸ºç©ºï¼Œè·³è¿‡æŸ¥è¯¢
```

**åŸå› ï¼š**
- ç”¨æˆ·æœªç™»å½•
- storageä¸­æ²¡æœ‰ä¿å­˜openid
- ç™»å½•æ—¶æœªæ­£ç¡®è®¾ç½®openid

**è§£å†³æ–¹æ¡ˆï¼š**

#### A. æ£€æŸ¥ç™»å½•æµç¨‹
```javascript
// åœ¨ç™»å½•æˆåŠŸåï¼Œåº”è¯¥ä¿å­˜openid
uni.login({
  success: (res) => {
    // è°ƒç”¨åç«¯æ¥å£è·å–openid
    request.post('/auth/login', { code: res.code })
      .then(result => {
        // ä¿å­˜openidåˆ°storage
        uni.setStorageSync('userOpenid', result.openid);
        console.log('âœ… openidå·²ä¿å­˜:', result.openid);
      });
  }
});
```

#### B. ä¸´æ—¶æµ‹è¯•æ–¹æ¡ˆ

åœ¨ `violation.vue` çš„ `mounted` ä¸­æ·»åŠ ï¼š
```javascript
mounted() {
  // ä¸´æ—¶æµ‹è¯•ï¼šæ‰‹åŠ¨è®¾ç½®openid
  if (!this.currentUserOpenid) {
    // ä»æ•°æ®åº“ä¸­æ‰¾ä¸€ä¸ªæœ‰æ•ˆçš„openidå¡«å…¥
    this.currentUserOpenid = 'oXXXXXXXXXXXXXXXXXXX';
    uni.setStorageSync('userOpenid', this.currentUserOpenid);
    console.log('ğŸ”§ [ä¸´æ—¶æµ‹è¯•] æ‰‹åŠ¨è®¾ç½®openid:', this.currentUserOpenid);
  }
}
```

---

### é—®é¢˜2ï¼šæ•°æ®åº“ä¸­æ‰¾ä¸åˆ°åŒ¹é…çš„openid

**ç—‡çŠ¶ï¼š**
```
âš ï¸ [å€¼ç­çŠ¶æ€åˆ‡æ¢] æœªæ‰¾åˆ°å·¡æ£€å‘˜ - openid: oXXXX
```

**åŸå› ï¼š**
- patrolè¡¨ä¸­æ²¡æœ‰è¯¥openidçš„è®°å½•
- openidä¸åŒ¹é…

**è§£å†³æ–¹æ¡ˆï¼š**

#### A. æ‰¹é‡æ›´æ–°ç°æœ‰å·¡æ£€å‘˜çš„openid

```sql
-- å¦‚æœå·¡æ£€å‘˜å·²å­˜åœ¨ä½†æ²¡æœ‰openidï¼Œéœ€è¦æ›´æ–°
-- æ–¹æ³•1ï¼šæ ¹æ®æ‰‹æœºå·æˆ–å§“åæ›´æ–°
UPDATE patrol 
SET openid = 'oXXXXXXXXXXXXXXXXXXX'  -- å®é™…openid
WHERE phone = '13800138000';  -- æˆ– username = 'å¼ ä¸‰'

-- æ–¹æ³•2ï¼šä¸ºæ‰€æœ‰å·¡æ£€å‘˜ç”Ÿæˆæµ‹è¯•openidï¼ˆä»…ç”¨äºå¼€å‘æµ‹è¯•ï¼‰
UPDATE patrol 
SET openid = CONCAT('o', LPAD(id, 20, '0'))
WHERE openid IS NULL OR openid = '';
```

#### B. åˆ›å»ºå¸¦openidçš„æ–°å·¡æ£€å‘˜

```sql
INSERT INTO patrol (
  usercode, username, phone, province, city, district, community,
  openid, notification_enabled, create_time
) VALUES (
  'P001', 'æµ‹è¯•å·¡æ£€å‘˜', '13800138000', 'æµ™æ±Ÿçœ', 'æ­å·å¸‚', 'è¥¿æ¹–åŒº', 'æµ‹è¯•å°åŒº',
  'oXXXXXXXXXXXXXXXXXXX',  -- å®é™…openid
  1,  -- é»˜è®¤å€¼ç­ä¸­
  NOW()
);
```

---

### é—®é¢˜3ï¼šæ›´æ–°è¯­å¥æ‰§è¡Œå¤±è´¥

**ç—‡çŠ¶ï¼š**
```
âŒ [å€¼ç­çŠ¶æ€åˆ‡æ¢] æ•°æ®åº“æ›´æ–°å¤±è´¥ - openid: oXXXX
```

**åŸå› ï¼š**
- æ•°æ®åº“è¿æ¥é—®é¢˜
- å­—æ®µæƒé™é—®é¢˜
- æ›´æ–°æ¡ä»¶ä¸æ»¡è¶³

**è§£å†³æ–¹æ¡ˆï¼š**

#### A. æ£€æŸ¥MyBatisæ›´æ–°è¯­å¥

æŸ¥çœ‹ `PatrolMapper.xml`ï¼Œç¡®è®¤æ˜¯å¦æœ‰è‡ªå®šä¹‰æ›´æ–°æ–¹æ³•å¯¼è‡´é—®é¢˜ã€‚

#### B. å¼€å¯SQLæ—¥å¿—

åœ¨ `application.yml` ä¸­æ·»åŠ ï¼š
```yaml
mybatis-plus:
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
```

è¿™æ ·å¯ä»¥çœ‹åˆ°å®é™…æ‰§è¡Œçš„SQLè¯­å¥ã€‚

---

## ğŸ“ å®Œæ•´æ’æŸ¥Checklist

### å‰ç«¯æ£€æŸ¥ âœ…

- [ ] å°ç¨‹åºæ§åˆ¶å°æ˜¯å¦æ˜¾ç¤ºopenidï¼Ÿ
- [ ] openidæ˜¯å¦ä¸ºæœ‰æ•ˆå€¼ï¼ˆä¸æ˜¯ç©ºå­—ç¬¦ä¸²ï¼‰ï¼Ÿ
- [ ] Networkä¸­è¯·æ±‚æ˜¯å¦å‘é€æˆåŠŸï¼Ÿ
- [ ] è¯·æ±‚çš„dataä¸­openidæ˜¯å¦æ­£ç¡®ï¼Ÿ
- [ ] å“åº”çš„codeæ˜¯å¦ä¸º'0'ï¼Ÿ

### åç«¯æ£€æŸ¥ âœ…

- [ ] åç«¯æ§åˆ¶å°æ˜¯å¦æœ‰æ—¥å¿—è¾“å‡ºï¼Ÿ
- [ ] æ¥å£æ˜¯å¦è¢«æ­£ç¡®è°ƒç”¨ï¼Ÿ
- [ ] æ˜¯å¦æ‰¾åˆ°åŒ¹é…çš„å·¡æ£€å‘˜ï¼Ÿ
- [ ] æ•°æ®åº“æ›´æ–°æ˜¯å¦æˆåŠŸï¼Ÿ
- [ ] è¿”å›çš„æ•°æ®æ˜¯å¦æ­£ç¡®ï¼Ÿ

### æ•°æ®åº“æ£€æŸ¥ âœ…

- [ ] patrolè¡¨æ˜¯å¦æœ‰openidå­—æ®µï¼Ÿ
- [ ] patrolè¡¨æ˜¯å¦æœ‰notification_enabledå­—æ®µï¼Ÿ
- [ ] æ˜¯å¦æœ‰åŒ¹é…openidçš„è®°å½•ï¼Ÿ
- [ ] æ‰‹åŠ¨æ›´æ–°SQLæ˜¯å¦æˆåŠŸï¼Ÿ
- [ ] å­—æ®µç±»å‹æ˜¯å¦æ­£ç¡®ï¼Ÿ

---

## ğŸš€ å¿«é€Ÿä¿®å¤æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šç¡®ä¿è¡¨ç»“æ„å®Œæ•´

```sql
-- æ‰§è¡Œä»¥ä¸‹SQLç¡®ä¿å­—æ®µå­˜åœ¨
ALTER TABLE patrol ADD COLUMN IF NOT EXISTS openid VARCHAR(64) COMMENT 'å¾®ä¿¡openid';
ALTER TABLE patrol ADD COLUMN IF NOT EXISTS notification_enabled INT DEFAULT 1 COMMENT 'æ˜¯å¦æ¥æ”¶é€šçŸ¥ï¼š1=æ˜¯ï¼Œ0=å¦';
ALTER TABLE patrol ADD COLUMN IF NOT EXISTS last_status_change_time DATETIME COMMENT 'æœ€åçŠ¶æ€å˜æ›´æ—¶é—´';

-- ä¸ºç°æœ‰è®°å½•è®¾ç½®é»˜è®¤å€¼
UPDATE patrol SET notification_enabled = 1 WHERE notification_enabled IS NULL;
```

### æ–¹æ¡ˆ2ï¼šæ›´æ–°ç°æœ‰å·¡æ£€å‘˜çš„openid

```sql
-- æŸ¥çœ‹å½“å‰æ²¡æœ‰openidçš„å·¡æ£€å‘˜
SELECT id, username, usercode, phone, openid FROM patrol WHERE openid IS NULL OR openid = '';

-- ä¸ºç‰¹å®šå·¡æ£€å‘˜æ›´æ–°openidï¼ˆä»å°ç¨‹åºç™»å½•æ—¶è·å–ï¼‰
UPDATE patrol 
SET openid = 'å®é™…çš„openid' 
WHERE phone = 'å·¡æ£€å‘˜çš„æ‰‹æœºå·' OR username = 'å·¡æ£€å‘˜å§“å';
```

### æ–¹æ¡ˆ3ï¼šæ·»åŠ è¯¦ç»†æ—¥å¿—

åœ¨Controllerä¸­æ·»åŠ æ›´å¤šæ—¥å¿—ï¼š

```java
@PostMapping("/toggleNotification")
public ResponseEntity<Result> toggleNotificationStatus(@RequestBody PatrolDutyRequest request) {
    
    System.out.println("============ å¼€å§‹å¤„ç†å€¼ç­çŠ¶æ€åˆ‡æ¢ ============");
    System.out.println("æ”¶åˆ°çš„openid: " + request.getOpenid());
    System.out.println("æ”¶åˆ°çš„enabled: " + request.getEnabled());
    
    Patrol patrol = patrolService.getPatrolByOpenId(request.getOpenid());
    System.out.println("æŸ¥è¯¢ç»“æœ: " + (patrol != null ? patrol.toString() : "null"));
    
    if (patrol != null) {
        System.out.println("æ›´æ–°å‰çš„notification_enabled: " + patrol.getNotificationEnabled());
        patrol.setNotificationEnabled(request.getEnabled());
        boolean updated = patrolService.updateById(patrol);
        System.out.println("æ›´æ–°ç»“æœ: " + updated);
        
        // ç«‹å³æŸ¥è¯¢éªŒè¯
        Patrol verify = patrolService.getPatrolByOpenId(request.getOpenid());
        System.out.println("éªŒè¯æŸ¥è¯¢çš„notification_enabled: " + verify.getNotificationEnabled());
    }
    
    System.out.println("============ å¤„ç†å®Œæˆ ============");
    
    // ... å…¶ä»–ä»£ç 
}
```

---

## ğŸ“ è·å–è°ƒè¯•ä¿¡æ¯

### å‰ç«¯è°ƒè¯•ä»£ç 

åœ¨ `violation.vue` çš„ `updateDutyStatus` æ–¹æ³•ä¸­æ·»åŠ ï¼š

```javascript
async updateDutyStatus(newStatus) {
    console.log('====== å¼€å§‹æ›´æ–°å€¼ç­çŠ¶æ€ ======');
    console.log('å½“å‰openid:', this.currentUserOpenid);
    console.log('ç›®æ ‡çŠ¶æ€:', newStatus ? 'å€¼ç­ä¸­' : 'ç¦»å²—');
    console.log('enabledå€¼:', newStatus ? 1 : 0);
    
    try {
        const res = await request({
            url: '/parking/patrol/toggleNotification',
            method: 'POST',
            data: {
                openid: this.currentUserOpenid,
                enabled: newStatus ? 1 : 0
            }
        });
        
        console.log('æ¥å£è¿”å›:', JSON.stringify(res, null, 2));
        console.log('====== æ›´æ–°å®Œæˆ ======');
        
        // ... å…¶ä»–ä»£ç 
    }
}
```

---

## âœ… é—®é¢˜è§£å†³åçš„éªŒè¯

### 1. å®Œæ•´æµ‹è¯•æµç¨‹

```
1. æ¸…é™¤ç¼“å­˜ï¼Œé‡æ–°ç™»å½•å°ç¨‹åº
   â†“
2. æŸ¥çœ‹æ§åˆ¶å°ï¼Œç¡®è®¤openidå·²æ­£ç¡®è·å–
   â†“
3. ç‚¹å‡»"ç¦»å²—"æŒ‰é’®
   â†“
4. è§‚å¯Ÿå‰ç«¯æ—¥å¿—ã€åç«¯æ—¥å¿—
   â†“
5. æŸ¥è¯¢æ•°æ®åº“ï¼š
   SELECT * FROM patrol WHERE openid = 'å®é™…openid';
   â†“
6. ç¡®è®¤notification_enabledå·²å˜ä¸º0
   â†“
7. åˆ·æ–°åå°ç®¡ç†ç³»ç»Ÿé¡µé¢
   â†“
8. ç¡®è®¤æ˜¾ç¤º"ç¦»å²—"çŠ¶æ€
```

### 2. éªŒè¯SQL

```sql
-- æŸ¥çœ‹æ‰€æœ‰å·¡æ£€å‘˜çš„å½“å‰çŠ¶æ€
SELECT 
    id,
    username,
    usercode,
    openid,
    notification_enabled,
    CASE 
        WHEN notification_enabled = 1 THEN 'å€¼ç­ä¸­'
        ELSE 'ç¦»å²—'
    END AS status_text,
    last_status_change_time
FROM patrol
ORDER BY last_status_change_time DESC;
```

---

**å¦‚æœæŒ‰ç…§ä»¥ä¸Šæ­¥éª¤ä»æ— æ³•è§£å†³ï¼Œè¯·æä¾›ï¼š**
1. å‰ç«¯æ§åˆ¶å°å®Œæ•´æ—¥å¿—
2. åç«¯æ§åˆ¶å°å®Œæ•´æ—¥å¿—
3. æ•°æ®åº“æŸ¥è¯¢ç»“æœæˆªå›¾
