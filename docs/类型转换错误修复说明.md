# ğŸ”§ ç±»å‹è½¬æ¢é”™è¯¯ä¿®å¤è¯´æ˜

## ğŸ“Œ é—®é¢˜æè¿°

å®šæ—¶ä»»åŠ¡æ‰§è¡Œæ—¶å‡ºç°ç±»å‹è½¬æ¢å¼‚å¸¸ï¼š

```
âŒ [ä¸‡è±¡ä¸Šä¸œæ£€æŸ¥] æ‰§è¡Œå¼‚å¸¸
java.lang.ClassCastException: java.lang.Integer cannot be cast to java.lang.Boolean
	at com.parkingmanage.task.ParkingTimeoutMonitoringTask.checkWanXiangVipBlacklist(ParkingTimeoutMonitoringTask.java:431)
```

### é”™è¯¯åŸå› 

åœ¨ `monthly_ticket_timeout_config` è¡¨ä¸­ï¼Œ`enable_overnight_check` å­—æ®µå®šä¹‰ä¸º `INTEGER` ç±»å‹ï¼ˆ0 æˆ– 1ï¼‰ï¼Œä½†ä»£ç ä¸­ç›´æ¥å¼ºåˆ¶è½¬æ¢ä¸º `Boolean` ç±»å‹ï¼Œå¯¼è‡´ç±»å‹è½¬æ¢å¼‚å¸¸ã€‚

---

## âœ… ä¿®å¤æ–¹æ¡ˆ

### 1ï¸âƒ£ ä¿®æ”¹å‰ï¼ˆé”™è¯¯ä»£ç ï¼‰

```java
// æ£€æŸ¥æ˜¯å¦å¯ç”¨è¿‡å¤œæ£€æŸ¥
Boolean enableOvernightCheck = (Boolean) config.get("enableOvernightCheck");
if (enableOvernightCheck == null || !enableOvernightCheck) {
    log.debug("â­ï¸ [ä¸‡è±¡ä¸Šä¸œæ£€æŸ¥] è¿‡å¤œæ£€æŸ¥æœªå¯ç”¨ï¼Œè·³è¿‡");
    return;
}
```

**é—®é¢˜**ï¼š
- ç›´æ¥å¼ºåˆ¶è½¬æ¢ `(Boolean)` ä¼šå¤±è´¥
- æ•°æ®åº“ä¸­å­˜å‚¨çš„æ˜¯ `Integer` ç±»å‹ï¼ˆ0 æˆ– 1ï¼‰

---

### 2ï¸âƒ£ ä¿®æ”¹åï¼ˆæ­£ç¡®ä»£ç ï¼‰

```java
// æ£€æŸ¥æ˜¯å¦å¯ç”¨è¿‡å¤œæ£€æŸ¥ï¼ˆæ•°æ®åº“ä¸­ä¸ºIntegerç±»å‹ï¼š1=å¯ç”¨ï¼Œ0=ç¦ç”¨ï¼‰
Object enableOvernightCheckObj = config.get("enableOvernightCheck");
boolean enableOvernightCheck = false;
if (enableOvernightCheckObj instanceof Integer) {
    enableOvernightCheck = ((Integer) enableOvernightCheckObj) == 1;
} else if (enableOvernightCheckObj instanceof Boolean) {
    enableOvernightCheck = (Boolean) enableOvernightCheckObj;
}

if (!enableOvernightCheck) {
    log.debug("â­ï¸ [ä¸‡è±¡ä¸Šä¸œæ£€æŸ¥] è¿‡å¤œæ£€æŸ¥æœªå¯ç”¨ï¼Œè·³è¿‡");
    return;
}
```

**æ”¹è¿›**ï¼š
- âœ… å…ˆè·å–ä¸º `Object` ç±»å‹
- âœ… ä½¿ç”¨ `instanceof` åˆ¤æ–­å®é™…ç±»å‹
- âœ… Integer ç±»å‹ï¼šå°† 1 è½¬æ¢ä¸º trueï¼Œ0 è½¬æ¢ä¸º false
- âœ… Boolean ç±»å‹ï¼šç›´æ¥ä½¿ç”¨ï¼ˆå‘å‰å…¼å®¹ï¼‰
- âœ… é»˜è®¤å€¼ä¸º falseï¼ˆå®‰å…¨é»˜è®¤ï¼‰

---

## ğŸ¯ æ•°æ®åº“å­—æ®µè¯´æ˜

### `monthly_ticket_timeout_config` è¡¨

| å­—æ®µå | æ•°æ®åº“ç±»å‹ | Javaç±»å‹ | è¯´æ˜ |
|--------|-----------|----------|------|
| `enable_overnight_check` | `INTEGER` | `int/Integer` | 1=å¯ç”¨ï¼Œ0=ç¦ç”¨ |
| `is_active` | `BOOLEAN/TINYINT` | `boolean/Boolean` | é…ç½®æ˜¯å¦æœ‰æ•ˆ |

### ä¸ºä»€ä¹ˆä½¿ç”¨ Integerï¼Ÿ

MySQL ä¸­æ²¡æœ‰çœŸæ­£çš„ Boolean ç±»å‹ï¼š
- `BOOLEAN` å®é™…ä¸Šæ˜¯ `TINYINT(1)` çš„åˆ«å
- å­˜å‚¨å€¼ä¸º 0ï¼ˆfalseï¼‰æˆ– 1ï¼ˆtrueï¼‰
- MyBatis è¯»å–æ—¶å¯èƒ½è¿”å› `Integer` è€Œä¸æ˜¯ `Boolean`

---

## ğŸ“ ä¿®å¤å†…å®¹

**æ–‡ä»¶**ï¼š`ParkingTimeoutMonitoringTask.java`

**ä½ç½®**ï¼š`checkWanXiangVipBlacklist()` æ–¹æ³•ç¬¬ 431 è¡Œé™„è¿‘

**ä¿®æ”¹ç±»å‹**ï¼šç±»å‹å®‰å…¨è½¬æ¢

---

## âœ… æµ‹è¯•éªŒè¯

### 1. é…ç½®å¯ç”¨çš„æƒ…å†µï¼ˆenable_overnight_check = 1ï¼‰

```sql
UPDATE monthly_ticket_timeout_config 
SET enable_overnight_check = 1 
WHERE park_code = '2KST9MNP';
```

**æœŸæœ›ç»“æœ**ï¼šâœ… è¿‡å¤œæ£€æŸ¥æ­£å¸¸æ‰§è¡Œ

### 2. é…ç½®ç¦ç”¨çš„æƒ…å†µï¼ˆenable_overnight_check = 0ï¼‰

```sql
UPDATE monthly_ticket_timeout_config 
SET enable_overnight_check = 0 
WHERE park_code = '2KST9MNP';
```

**æœŸæœ›ç»“æœ**ï¼šâœ… è·³è¿‡è¿‡å¤œæ£€æŸ¥ï¼Œæ—¥å¿—æ˜¾ç¤º"è¿‡å¤œæ£€æŸ¥æœªå¯ç”¨ï¼Œè·³è¿‡"

### 3. é…ç½®ä¸º NULL çš„æƒ…å†µ

```sql
UPDATE monthly_ticket_timeout_config 
SET enable_overnight_check = NULL 
WHERE park_code = '2KST9MNP';
```

**æœŸæœ›ç»“æœ**ï¼šâœ… è·³è¿‡è¿‡å¤œæ£€æŸ¥ï¼ˆé»˜è®¤ä¸º falseï¼‰

---

## ğŸ”— ç›¸å…³ä»£ç 

### é…ç½®å®ä½“ç±»

`MonthlyTicketTimeoutConfig.java`:
```java
@ApiModelProperty(value = "æ˜¯å¦å¯ç”¨è¿‡å¤œåœè½¦æ£€æŸ¥ï¼š1-å¯ç”¨ï¼Œ0-ç¦ç”¨")
private Integer enableOvernightCheck;
```

### å®šæ—¶ä»»åŠ¡

`ParkingTimeoutMonitoringTask.java`:
- æ–¹æ³•ï¼š`checkWanXiangVipBlacklist()`
- è¡Œå·ï¼š431-442

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç±»å‹ä¸€è‡´æ€§**ï¼šæ•°æ®åº“å­—æ®µç±»å‹å’Œ Java ä»£ç ä¸­çš„ç±»å‹å¤„ç†è¦ä¿æŒä¸€è‡´
2. **å‘å‰å…¼å®¹**ï¼šä»£ç åŒæ—¶æ”¯æŒ Integer å’Œ Boolean ç±»å‹ï¼Œç¡®ä¿å‘å‰å…¼å®¹
3. **é»˜è®¤å€¼**ï¼šå½“å€¼ä¸º null æˆ–æ— æ³•è¯†åˆ«æ—¶ï¼Œé»˜è®¤ä¸º falseï¼ˆä¸å¯ç”¨ï¼‰
4. **å…¶ä»– Boolean å­—æ®µ**ï¼šå¦‚æœæœ‰å…¶ä»–ç±»ä¼¼çš„ Boolean å­—æ®µï¼Œä¹Ÿåº”è¯¥ä½¿ç”¨ç›¸åŒçš„è½¬æ¢é€»è¾‘

---

## âœ… å®Œæˆæƒ…å†µ

- âœ… ä¿®å¤ç±»å‹è½¬æ¢é”™è¯¯
- âœ… æ·»åŠ ç±»å‹åˆ¤æ–­é€»è¾‘
- âœ… æ”¯æŒ Integer å’Œ Boolean ä¸¤ç§ç±»å‹
- âœ… æ·»åŠ å®‰å…¨é»˜è®¤å€¼
- âœ… ç¼–å†™ä¿®å¤æ–‡æ¡£

**ä¿®å¤å®Œæˆï¼** å®šæ—¶ä»»åŠ¡ç°åœ¨å¯ä»¥æ­£å¸¸æ‰§è¡Œäº†ã€‚ğŸ‰
