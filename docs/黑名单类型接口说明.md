# é»‘åå•ç±»å‹æ¥å£è¯´æ˜æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

æ–°å¢äº†è·å–é»‘åå•ç±»å‹åˆ—è¡¨çš„æ¥å£ï¼Œç”¨äºåœ¨å°ç¨‹åºç«¯å±•ç¤ºä¸‹æ‹‰é€‰æ‹©å™¨ï¼Œè®©ç®¡ç†å‘˜é€‰æ‹©åˆé€‚çš„é»‘åå•ç±»å‹ã€‚

---

## ğŸ”Œ æ¥å£ä¿¡æ¯

### **1. POST æ–¹å¼**

**æ¥å£åœ°å€ï¼š** `/parking/acms/vip/blacklist-types`

**è¯·æ±‚æ–¹æ³•ï¼š** `POST`

**Content-Typeï¼š** `application/json`

**è¯·æ±‚å‚æ•°ï¼š**
```json
{
  "parkName": "ä¸œåŒ—æ—ä¸šå¤§å­¦"
}
```

**æˆåŠŸå“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 200,
  "msg": "æ“ä½œæˆåŠŸ",
  "data": {
    "blacklistTypes": [
      {
        "code": "703",
        "name": "è¿è§„é»‘åå•",
        "vipGroupType": "1",
        "vipType": "2",
        "description": "å› è¿è§„åœè½¦è¢«åŠ å…¥é»‘åå•"
      },
      {
        "code": "704",
        "name": "å®‰å…¨é»‘åå•",
        "vipGroupType": "1",
        "vipType": "2",
        "description": "å› å®‰å…¨åŸå› è¢«åŠ å…¥é»‘åå•"
      }
    ],
    "isDefault": false,
    "count": 2
  }
}
```

**å…œåº•å“åº”ç¤ºä¾‹ï¼ˆACMSæœªé…ç½®æ—¶ï¼‰ï¼š**
```json
{
  "code": 200,
  "msg": "æ“ä½œæˆåŠŸ",
  "data": {
    "blacklistTypes": [
      {
        "code": "default_violation",
        "name": "è¿è§„é»‘åå•",
        "vipGroupType": "1",
        "vipType": "2",
        "description": "å› è¿è§„åœè½¦è¢«åŠ å…¥é»‘åå•"
      },
      {
        "code": "default_security",
        "name": "å®‰å…¨é»‘åå•",
        "vipGroupType": "1",
        "vipType": "2",
        "description": "å› å®‰å…¨åŸå› è¢«åŠ å…¥é»‘åå•"
      },
      {
        "code": "default_malicious",
        "name": "æ¶æ„é»‘åå•",
        "vipGroupType": "1",
        "vipType": "2",
        "description": "å› æ¶æ„è¡Œä¸ºè¢«åŠ å…¥é»‘åå•"
      }
    ],
    "isDefault": true,
    "message": "ACMSç³»ç»Ÿæœªé…ç½®é»‘åå•ç±»å‹ï¼Œå·²è¿”å›é»˜è®¤é€‰é¡¹"
  }
}
```

---

### **2. GET æ–¹å¼ï¼ˆç®€åŒ–ç‰ˆï¼‰**

**æ¥å£åœ°å€ï¼š** `/parking/acms/vip/blacklist-types`

**è¯·æ±‚æ–¹æ³•ï¼š** `GET`

**è¯·æ±‚å‚æ•°ï¼ˆURLå‚æ•°ï¼‰ï¼š**
```
parkName=ä¸œåŒ—æ—ä¸šå¤§å­¦
```

**å®Œæ•´ç¤ºä¾‹ï¼š**
```
GET http://www.xuerparking.cn:8080/parking/acms/vip/blacklist-types?parkName=ä¸œåŒ—æ—ä¸šå¤§å­¦
```

**å“åº”æ ¼å¼ä¸ POST æ–¹å¼ç›¸åŒ**

---

## ğŸ¯ æ¥å£ç‰¹ç‚¹

### **1. æ™ºèƒ½ç­›é€‰**
- è‡ªåŠ¨ä» ACMS ç³»ç»Ÿè·å–æ‰€æœ‰ VIP ç±»å‹
- ç­›é€‰å‡ºåç§°åŒ…å«"é»‘åå•"çš„ç±»å‹
- è¿”å›ç»“æ„åŒ–æ•°æ®ä¾›å‰ç«¯ä½¿ç”¨

### **2. å®¹é”™æœºåˆ¶**
- **ACMS æœªé…ç½®é»‘åå•ç±»å‹**ï¼šè¿”å›é»˜è®¤ 3 ç§é»‘åå•ç±»å‹
- **ACMS ç³»ç»Ÿå¼‚å¸¸**ï¼šè¿”å›é»˜è®¤é»‘åå•ç±»å‹ï¼Œç¡®ä¿åŠŸèƒ½å¯ç”¨
- **ç½‘ç»œè¶…æ—¶**ï¼šè¿”å›é»˜è®¤é»‘åå•ç±»å‹

### **3. å…œåº•æ–¹æ¡ˆ**
é»˜è®¤è¿”å›çš„ 3 ç§é»‘åå•ç±»å‹ï¼š
1. **è¿è§„é»‘åå•**ï¼ˆ`default_violation`ï¼‰- å› è¿è§„åœè½¦è¢«åŠ å…¥é»‘åå•
2. **å®‰å…¨é»‘åå•**ï¼ˆ`default_security`ï¼‰- å› å®‰å…¨åŸå› è¢«åŠ å…¥é»‘åå•
3. **æ¶æ„é»‘åå•**ï¼ˆ`default_malicious`ï¼‰- å› æ¶æ„è¡Œä¸ºè¢«åŠ å…¥é»‘åå•

---

## ğŸ”„ è°ƒç”¨æµç¨‹

```
å°ç¨‹åºç«¯
   â†“
åç«¯ Controller (AcmsVipController)
   â†“
åç«¯ Service (AcmsVipService)
   â†“
è°ƒç”¨ ACMS æ¥å£ (GET_CAR_VIP_TYPE - 4.25)
   â†“
ç­›é€‰é»‘åå•ç±»å‹ï¼ˆåç§°åŒ…å«"é»‘åå•"ï¼‰
   â†“
è¿”å›ç»™å°ç¨‹åºç«¯
```

---

## ğŸ“± å°ç¨‹åºç«¯è°ƒç”¨ç¤ºä¾‹

### **åœ¨ onLoad æ—¶è·å–é»‘åå•ç±»å‹åˆ—è¡¨**

```javascript
async loadBlacklistTypes() {
  try {
    const response = await uni.request({
      url: 'http://your-server/parking/acms/vip/blacklist-types',
      method: 'POST',
      header: {
        'Content-Type': 'application/json'
      },
      data: {
        parkName: 'ä¸œåŒ—æ—ä¸šå¤§å­¦'
      }
    });

    if (response.statusCode === 200 && response.data.code === 200) {
      const { blacklistTypes, isDefault } = response.data.data;
      
      this.blacklistTypeOptions = blacklistTypes;
      
      // è®¾ç½®é»˜è®¤é€‰ä¸­ç¬¬ä¸€ä¸ª
      if (blacklistTypes.length > 0) {
        this.formData.blacklistTypeCode = blacklistTypes[0].code;
        this.formData.blacklistTypeName = blacklistTypes[0].name;
      }
      
      // å¦‚æœæ˜¯é»˜è®¤æ•°æ®ï¼Œå¯ä»¥æç¤ºç”¨æˆ·
      if (isDefault) {
        console.warn('âš ï¸ ä½¿ç”¨é»˜è®¤é»‘åå•ç±»å‹');
      }
      
      console.log('âœ… é»‘åå•ç±»å‹åŠ è½½æˆåŠŸ:', blacklistTypes);
    } else {
      throw new Error('æ¥å£è¿”å›å¤±è´¥');
    }
  } catch (error) {
    console.error('âŒ è·å–é»‘åå•ç±»å‹å¤±è´¥:', error);
    
    // ä½¿ç”¨æœ¬åœ°ç¡¬ç¼–ç çš„å…œåº•æ•°æ®
    this.blacklistTypeOptions = [
      {
        code: 'local_violation',
        name: 'è¿è§„é»‘åå•',
        description: 'å› è¿è§„åœè½¦è¢«åŠ å…¥é»‘åå•'
      }
    ];
  }
}
```

### **åœ¨ picker ä¸­ä½¿ç”¨**

```vue
<picker 
  mode="selector" 
  :range="blacklistTypeOptions" 
  range-key="name"
  :value="blacklistTypeIndex"
  @change="onBlacklistTypeChange"
>
  <view class="picker-input">
    <text>{{ selectedBlacklistType.name || 'è¯·é€‰æ‹©é»‘åå•ç±»å‹' }}</text>
    <text class="picker-arrow">â–¼</text>
  </view>
</picker>
```

---

## ğŸ”§ åç«¯æŠ€æœ¯å®ç°

### **1. Service å±‚ï¼ˆAcmsVipService.javaï¼‰**

- **æ–¹æ³•**ï¼š`getBlacklistTypes(String parkName)`
- **åŠŸèƒ½**ï¼š
  - è°ƒç”¨ ACMS 4.25 æ¥å£ï¼ˆ`GET_CAR_VIP_TYPE`ï¼‰
  - ç­›é€‰å‡ºåç§°åŒ…å«"é»‘åå•"çš„ VIP ç±»å‹
  - ä¸ºæ¯ç§ç±»å‹ç”Ÿæˆæè¿°ä¿¡æ¯

**å…³é”®ä»£ç ï¼š**
```java
public List<BlacklistTypeInfo> getBlacklistTypes(String parkName) {
    // æ„å»ºè¯·æ±‚
    AcmsRequest request = buildBlacklistTypesRequest();
    
    // è°ƒç”¨ ACMS æ¥å£
    String response = HttpClientUtil.doPostJson(
        acmsApiUrl + "/cxfService/external/extReq", 
        JSON.toJSONString(request)
    );
    
    // è§£æå¹¶ç­›é€‰é»‘åå•ç±»å‹
    return parseBlacklistTypesResponse(response);
}
```

### **2. Controller å±‚ï¼ˆAcmsVipController.javaï¼‰**

- **æ¥å£**ï¼š`/parking/acms/vip/blacklist-types`
- **åŠŸèƒ½**ï¼š
  - å‚æ•°æ ¡éªŒ
  - è°ƒç”¨ Service å±‚
  - å¼‚å¸¸å¤„ç†å’Œå…œåº•æ–¹æ¡ˆ
  - ç»Ÿä¸€è¿”å›æ ¼å¼

**å…³é”®ä»£ç ï¼š**
```java
@PostMapping("/blacklist-types")
public ResponseEntity<Result> getBlacklistTypes(@RequestBody BlacklistTypesRequest request) {
    List<BlacklistTypeInfo> blacklistTypes = acmsVipService.getBlacklistTypes(request.getParkName());
    
    if (blacklistTypes == null || blacklistTypes.isEmpty()) {
        // è¿”å›é»˜è®¤é»‘åå•ç±»å‹ï¼ˆå…œåº•ï¼‰
        data.put("blacklistTypes", getDefaultBlacklistTypes());
        data.put("isDefault", true);
    }
    
    return ResponseEntity.ok(Result.success(data));
}
```

---

## ğŸ“Š æ•°æ®å­—æ®µè¯´æ˜

### **BlacklistTypeInfo å¯¹è±¡**

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|
| `code` | String | VIPç±»å‹ç¼–ç ï¼ˆç”¨äºæäº¤æ‹‰é»‘æ—¶çš„ vip_type_codeï¼‰ | "703" |
| `name` | String | VIPç±»å‹åç§°ï¼ˆç”¨äºæäº¤æ‹‰é»‘æ—¶çš„ vip_type_nameï¼‰ | "è¿è§„é»‘åå•" |
| `vipGroupType` | String | VIPåˆ†ç»„ç±»å‹ | "1" |
| `vipType` | String | VIPç±»å‹ | "2" |
| `description` | String | æè¿°ä¿¡æ¯ï¼ˆå‰ç«¯å±•ç¤ºç”¨ï¼‰ | "å› è¿è§„åœè½¦è¢«åŠ å…¥é»‘åå•" |

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### **1. è½¦åœºé™åˆ¶**
- ç›®å‰ä»…æ”¯æŒ"ä¸œåŒ—æ—ä¸šå¤§å­¦"è½¦åœº
- å…¶ä»–è½¦åœºä¼šè¿”å› `null`

### **2. ç­›é€‰è§„åˆ™**
- å½“å‰ç­›é€‰æ¡ä»¶ï¼š`custom_vip_name` åŒ…å«"é»‘åå•"
- å¦‚éœ€è°ƒæ•´ï¼Œä¿®æ”¹ `AcmsVipService.parseBlacklistTypesResponse()` æ–¹æ³•

### **3. é»˜è®¤ç±»å‹**
- é»˜è®¤ç±»å‹çš„ `code` ä»¥ `default_` å¼€å¤´
- å‰ç«¯å¯é€šè¿‡ `isDefault` å­—æ®µåˆ¤æ–­æ˜¯å¦ä¸ºé»˜è®¤æ•°æ®

### **4. ACMS é…ç½®**
- éœ€è¦åœ¨ ACMS ç³»ç»Ÿä¸­é¢„å…ˆé…ç½®å¥½é»‘åå•ç±»å‹
- é»‘åå•ç±»å‹åç§°å¿…é¡»åŒ…å«"é»‘åå•"å…³é”®å­—

---

## ğŸ§ª æµ‹è¯•å»ºè®®

### **ä½¿ç”¨ Postman/Apifox æµ‹è¯•**

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```http
POST http://www.xuerparking.cn:8080/parking/acms/vip/blacklist-types
Content-Type: application/json

{
  "parkName": "ä¸œåŒ—æ—ä¸šå¤§å­¦"
}
```

**é¢„æœŸç»“æœï¼š**
- âœ… è¿”å›é»‘åå•ç±»å‹åˆ—è¡¨
- âœ… åŒ…å« `code`ã€`name`ã€`description` ç­‰å­—æ®µ
- âœ… `isDefault` æ ‡è¯†æ˜¯å¦ä¸ºé»˜è®¤æ•°æ®

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### **v1.0.0 (2025-10-03)**
- âœ… æ–°å¢ POST æ¥å£ `/parking/acms/vip/blacklist-types`
- âœ… æ–°å¢ GET æ¥å£ `/parking/acms/vip/blacklist-types`
- âœ… å®ç° ACMS 4.25 æ¥å£è°ƒç”¨
- âœ… å®ç°é»‘åå•ç±»å‹ç­›é€‰é€»è¾‘
- âœ… å®ç°å…œåº•æ–¹æ¡ˆï¼ˆé»˜è®¤ 3 ç§ç±»å‹ï¼‰
- âœ… æ·»åŠ è¯¦ç»†æ—¥å¿—è¾“å‡º

---

## ğŸ”— ç›¸å…³æ¥å£

- **4.6 è·å–è½¦ä¸»ä¿¡æ¯** - `/parking/acms/vip/owner-info`
- **4.13 è·å–VIPç¥¨ä¿¡æ¯** - `/parking/acms/vip/vip-ticket-info`
- **èåˆæŸ¥è¯¢** - `/parking/acms/vip/merged-info`
- **4.25 è·å–é»‘åå•ç±»å‹** - `/parking/acms/vip/blacklist-types` âœ¨ æ–°å¢

---

## ğŸ’¡ ä¸‹ä¸€æ­¥è®¡åˆ’

1. **æ·»åŠ é»‘åå•æ“ä½œæ¥å£**ï¼ˆ4.17 æ·»åŠ é»‘åå•ï¼‰
2. **æ·»åŠ ç§»é™¤é»‘åå•æ¥å£**ï¼ˆ4.18 ç§»é™¤é»‘åå•ï¼‰
3. **æ·»åŠ æŸ¥è¯¢é»‘åå•æ¥å£**
4. **æ”¯æŒæ›´å¤šè½¦åœºé…ç½®**

---

**æ–‡æ¡£åˆ›å»ºæ—¶é—´ï¼š** 2025-10-03  
**æœ€åæ›´æ–°ï¼š** 2025-10-03  
**ç»´æŠ¤äººå‘˜ï¼š** System

