# 短信模板管理 - 路由和菜单配置指南

## ✅ 已完成的配置

### 1. 前端路由配置
**文件**: `manage-front/src/router/index.js`

已添加短信模板管理路由：

```javascript
{
    path: "smsTemplate",
    name: "SmsTemplate",
    meta: {
        title: '短信模板管理',
        permission: "93"
    },
    component: () => import("../views/admin/SmsTemplate.vue")
}
```

- **路由路径**: `/admin/smsTemplate`
- **页面标题**: 短信模板管理
- **权限编号**: 93

### 2. 侧边栏图标配置
**文件**: `manage-front/src/components/Sidebar.vue`

已添加短信模板管理的图标配置：

```vue
<i v-if="subItem.title === '短信模板管理'">
    <img src="../icons/svg/NotifierInfo.svg">
</i>
```

## 🔧 需要配置的部分

### 后端菜单权限配置

由于系统的菜单结构是从数据库动态加载的（通过接口 `/parking/role/sidebar/querySidebarById`），需要在数据库中添加短信模板管理的菜单配置。

## 📋 配置步骤

### 方法一：通过SQL直接配置（推荐）

#### 步骤1：查看当前权限结构

```sql
-- 查看所有权限，了解菜单层级结构
SELECT id, NAME, PATH, PID, 
       CASE WHEN PID = 0 THEN '顶级菜单' 
            ELSE (SELECT NAME FROM permission WHERE id = PID) 
       END as parent_name
FROM permission 
WHERE deleted = 0 
ORDER BY PID, id;
```

#### 步骤2：确定父级菜单ID

找到"外来车辆管理"或其他合适的父级菜单（通常短信模板管理应该放在停车管理相关的菜单组下）。

假设查询结果如下：
```
id   NAME              PATH                    PID   parent_name
------------------------------------------------------------------
4    外来车辆管理       -                       0     顶级菜单
42   外来车辆预约       /admin/vehicleReservation  4     外来车辆管理
43   车场信息管理       /admin/yardInfo         4     外来车辆管理
44   黑名单管理         /admin/blackList        4     外来车辆管理
...
```

在这个例子中，父级菜单ID（PID）应该是 **4**。

#### 步骤3：插入短信模板管理权限

```sql
-- 插入短信模板管理菜单项
INSERT INTO `permission` (`NAME`, `PATH`, `PID`, `DELETED`) 
VALUES ('短信模板管理', '/admin/smsTemplate', 4, 0);

-- 查询刚插入的记录，获取其ID
SELECT * FROM permission WHERE NAME = '短信模板管理';
```

假设新插入的权限ID为 **93**。

#### 步骤4：查看需要更新的角色

```sql
-- 查看所有角色及其权限
SELECT id, name, permission FROM role WHERE deleted = 0;
```

例如输出：
```
id   name      permission
-----------------------------------------------
1    管理员    11,12,13,21,22,23,31,34,42,43,44,45,46,47,48,49,71,72,76,77,78,79,80,81
2    普通用户  42,43,71,72
```

#### 步骤5：更新角色权限

为需要访问短信模板管理的角色添加权限ID **93**：

```sql
-- 为管理员角色添加短信模板管理权限（在车场信息管理43后面）
UPDATE role 
SET permission = REPLACE(permission, ',43,', ',43,93,')
WHERE id = 1 
  AND permission LIKE '%,43,%' 
  AND permission NOT LIKE '%,93,%';

-- 或者直接设置完整的权限列表（推荐，更安全）
UPDATE role 
SET permission = '11,12,13,21,22,23,31,34,42,43,93,44,45,46,47,48,49,71,72,76,77,78,79,80,81'
WHERE id = 1;
```

#### 步骤6：验证配置

```sql
-- 验证权限是否正确添加
SELECT id, NAME, PATH, PID 
FROM permission 
WHERE NAME = '短信模板管理';

-- 验证角色权限是否更新
SELECT id, name, permission 
FROM role 
WHERE deleted = 0 
  AND permission LIKE '%93%';
```

### 方法二：通过系统权限管理界面配置

1. 登录系统管理员账号
2. 进入"系统管理" → "权限管理"
3. 找到"外来车辆管理"或相关的父级菜单
4. 添加子菜单：
   - 权限名称：短信模板管理
   - 路径：/admin/smsTemplate
   - 父级ID：选择合适的父级菜单
5. 保存后，进入"角色管理"
6. 为相应角色勾选"短信模板管理"权限
7. 保存配置

## 🎯 访问短信模板管理

配置完成后：

1. **重新登录系统**（确保权限刷新）
2. 在左侧菜单栏找到对应的菜单组（如"外来车辆管理"）
3. 展开后可以看到"短信模板管理"菜单项
4. 点击进入短信模板管理页面

### 直接访问链接

也可以直接在浏览器中访问：
```
http://your-domain/#/admin/smsTemplate
```

## 📊 完整的权限编号对照表

| 权限编号 | 菜单名称 | 路由路径 |
|---------|---------|---------|
| 43 | 车场信息管理 | /admin/yardInfo |
| **93** | **短信模板管理** | **/admin/smsTemplate** |
| 44 | 黑名单管理 | /admin/blackList |
| 45 | 商场信息管理 | /admin/notifierInfo |

## 🔍 故障排查

### 问题1：登录后看不到短信模板管理菜单

**解决方案**：
1. 检查数据库 `permission` 表是否已添加记录
2. 检查当前登录角色的 `permission` 字段是否包含权限ID 93
3. 清除浏览器缓存，重新登录
4. 检查浏览器控制台是否有错误信息

### 问题2：点击菜单后页面404

**解决方案**：
1. 检查前端路由配置（`router/index.js`）是否正确
2. 确认 `SmsTemplate.vue` 文件是否存在于 `src/views/admin/` 目录
3. 检查路由路径是否与数据库中的 `PATH` 字段一致

### 问题3：菜单显示但没有图标

**解决方案**：
1. 检查 `Sidebar.vue` 中是否添加了图标配置
2. 确认图标文件是否存在
3. 检查菜单的 `title` 字段是否完全匹配（包括空格）

## 📝 配置检查清单

- [ ] 数据库 `permission` 表已添加短信模板管理记录
- [ ] 相应角色的 `permission` 字段已包含权限ID 93
- [ ] 前端路由配置正确（`router/index.js`）
- [ ] 侧边栏图标配置正确（`Sidebar.vue`）
- [ ] `SmsTemplate.vue` 页面文件存在
- [ ] 已重新登录系统
- [ ] 菜单正常显示
- [ ] 页面可以正常访问和操作

## 🎉 完成

配置完成后，短信模板管理功能就可以正常使用了！

用户可以通过侧边栏菜单访问短信模板管理页面，进行模板的增删改查操作，并在车场管理中关联使用这些模板。

