# 短信模板管理功能使用说明

## 功能概述

本功能实现了停车场管理系统的短信模板管理，允许管理员配置不同的短信模板，并在车场管理中关联使用。

## 数据库部署

### 1. 执行SQL脚本

运行 `sms_template.sql` 文件以创建数据库表和初始数据：

```bash
mysql -u your_username -p your_database < sms_template.sql
```

### 2. 数据库表结构

#### sms_template 表（短信模板表）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | int(11) | 主键ID |
| template_name | varchar(100) | 模板名称 |
| sign_name | varchar(100) | 模板签名（例如：东北林业大学） |
| template_code | varchar(50) | 模板CODE（例如：SMS_496020098） |
| template_type | int(11) | 模板类型（1-违规提醒，2-停车超时，3-其他） |
| description | varchar(500) | 模板描述 |
| deleted | int(11) | 逻辑删除标识 |
| gmt_create | datetime | 创建时间 |
| gmt_modified | datetime | 更新时间 |

#### yard_info 表修改

新增字段：
- `sms_template_id` - 关联的短信模板ID

## 后端实现

### 1. 实体类

- `SmsTemplate.java` - 短信模板实体类
- `YardInfo.java` - 车场信息实体类（已添加 smsTemplateId 字段）

### 2. API接口

#### 短信模板管理接口

**基础路径**: `/parking/smsTemplate`

| 接口 | 方法 | 说明 |
|------|------|------|
| `/parking/smsTemplate` | POST | 新增短信模板 |
| `/parking/smsTemplate` | PUT | 修改短信模板 |
| `/parking/smsTemplate/{id}` | DELETE | 删除短信模板 |
| `/parking/smsTemplate/list` | GET | 查询所有模板 |
| `/parking/smsTemplate/{id}` | GET | 根据ID查询 |
| `/parking/smsTemplate/page` | GET | 分页查询 |
| `/parking/smsTemplate/type/{templateType}` | GET | 按类型查询 |

#### 车场信息接口

车场信息的 POST 和 PUT 接口已支持 `smsTemplateId` 字段。

## 前端实现

### 1. 短信模板管理页面

**路径**: `src/views/admin/SmsTemplate.vue`

功能：
- ✅ 短信模板列表展示
- ✅ 新增短信模板
- ✅ 编辑短信模板
- ✅ 删除短信模板
- ✅ 按模板名称和类型搜索
- ✅ 分页查询

**字段验证规则**：
- **模板签名**：只能输入中文字符（例如：东北林业大学）
- **模板CODE**：必须为 `SMS_` 开头加数字的格式（例如：SMS_496020098）

### 2. 车场管理页面增强

**路径**: `src/views/admin/YardInfo.vue`

新增功能：
- ✅ 在车场编辑/新增时可选择关联的短信模板
- ✅ 实时显示选中模板的详细信息（签名、CODE、描述）
- ✅ 下拉框显示模板名称和CODE

## 使用流程

### 1. 添加短信模板

1. 进入"短信模板管理"页面
2. 点击"新增模板"按钮
3. 填写模板信息：
   - **模板名称**：给模板起个易识别的名称
   - **模板签名**：输入中文签名（例如：东北林业大学）
   - **模板CODE**：输入阿里云短信模板CODE（例如：SMS_496020098）
   - **模板类型**：选择模板用途（违规提醒/停车超时/其他）
   - **模板描述**：填写模板说明
4. 点击"确定"保存

### 2. 为车场配置短信模板

1. 进入"车场信息管理"页面
2. 新增或编辑车场信息
3. 在"短信模板配置"区域选择要使用的短信模板
4. 系统会显示选中模板的详细信息
5. 保存车场信息

### 3. 修改短信模板

1. 在"短信模板管理"页面点击"编辑"按钮
2. 修改模板信息
3. 点击"确定"保存

### 4. 删除短信模板

1. 在"短信模板管理"页面点击"删除"按钮
2. 确认删除操作

**注意**：删除模板前，建议先检查是否有车场正在使用该模板。

## 格式说明

### 模板签名格式

- ✅ 正确示例：`东北林业大学`、`停车管理中心`
- ❌ 错误示例：`NEFU`、`Parking123`、`停车-管理`

### 模板CODE格式

- ✅ 正确示例：`SMS_496020098`、`SMS_498220005`
- ❌ 错误示例：`SMS496020098`、`sms_496020098`、`SMS_`

## 数据示例

系统已预置两个模板示例：

1. **违规提醒模板**
   - 签名：东北林业大学
   - CODE：SMS_496020098
   - 类型：违规提醒
   
2. **停车超时模板**
   - 签名：东北林业大学
   - CODE：SMS_498220005
   - 类型：停车超时

## 注意事项

1. **模板CODE唯一性**：系统会自动检查模板CODE是否重复
2. **格式验证**：前端会实时验证签名和CODE格式
3. **逻辑删除**：删除操作为逻辑删除，数据不会真正从数据库中移除
4. **车场关联**：一个车场只能关联一个短信模板，但一个模板可以被多个车场使用
5. **权限控制**：建议只允许管理员操作短信模板管理功能

## 扩展功能建议

未来可以考虑添加：
- 短信发送记录管理
- 模板变量配置
- 短信发送统计
- 模板测试功能
- 批量导入模板

## 技术支持

如有问题，请联系技术支持团队。

