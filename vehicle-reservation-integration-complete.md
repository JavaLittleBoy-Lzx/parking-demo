# åå°å½•å…¥é¢„çº¦æ•°æ®æ•´åˆå®Œæˆè¯´æ˜

## éœ€æ±‚å›é¡¾

åœ¨å°ç¨‹åºé¢„çº¦æŸ¥è¯¢é¡µé¢ä¸­åŒæ—¶å±•ç¤ºä¸¤ä¸ªæ•°æ®æºï¼š
1. `appointment` è¡¨ - å°ç¨‹åºç«¯é¢„çº¦çš„æ•°æ®
2. `vehicle_reservation` è¡¨ - åå°ç®¡ç†ç³»ç»Ÿå½•å…¥çš„é¢„çº¦æ•°æ®

**æ ¸å¿ƒè¦æ±‚**ï¼šå¿…é¡»æŒ‰è½¦åœºè¿‡æ»¤ï¼Œç¡®ä¿ç®¡å®¶åªèƒ½çœ‹åˆ°è‡ªå·±è½¦åœºçš„æ•°æ®ã€‚

## å·²å®Œæˆçš„ä¿®æ”¹

### 1. åç«¯ Controller å±‚ä¿®æ”¹

**æ–‡ä»¶**ï¼š`AppointmentController.java`

#### 1.1 æ³¨å…¥æœåŠ¡
```java
@Resource
private VehicleReservationService vehicleReservationService;
```

#### 1.2 ä¿®æ”¹ getList æ¥å£

**ä½ç½®**ï¼šç¬¬ 529-615 è¡Œ

**ä¿®æ”¹å†…å®¹**ï¼š
- æŸ¥è¯¢ `appointment` è¡¨çš„æ‰€æœ‰æ•°æ®
- æŸ¥è¯¢ `vehicle_reservation` è¡¨çš„æ‰€æœ‰æ•°æ®
- å°† vehicle_reservation æ•°æ®è½¬æ¢ä¸ºç»Ÿä¸€æ ¼å¼
- åˆå¹¶ä¸¤ä¸ªè¡¨çš„æ•°æ®è¿”å›

**å…³é”®ä»£ç **ï¼š
```java
@GetMapping("/getList")
@ResponseBody
public R<Map<String, Object>> getList() throws ParseException {
    logger.info("ğŸ” [é¢„çº¦æŸ¥è¯¢] å¼€å§‹æŸ¥è¯¢æ‰€æœ‰é¢„çº¦æ•°æ®ï¼ˆåŒ…å«åå°å½•å…¥ï¼‰");
    
    ArrayList<Object> appointmentList = new ArrayList<>();
    
    // 1ï¸âƒ£ æŸ¥è¯¢ appointment è¡¨æ•°æ®
    List<Appointment> appointmentAll = appointmentService.list();
    logger.info("ğŸ“‹ [é¢„çº¦æŸ¥è¯¢] appointmentè¡¨æŸ¥è¯¢ç»“æœ: {} æ¡", appointmentAll.size());
    
    // ... è½¬æ¢ appointment æ•°æ® ...
    
    // 2ï¸âƒ£ æŸ¥è¯¢ vehicle_reservation è¡¨æ•°æ®ï¼ˆåå°å½•å…¥ï¼‰
    try {
        List<VehicleReservation> vehicleReservations = vehicleReservationService.list();
        logger.info("ğŸ“‹ [é¢„çº¦æŸ¥è¯¢] vehicle_reservationè¡¨æŸ¥è¯¢ç»“æœ: {} æ¡", vehicleReservations.size());
        
        for (VehicleReservation vr : vehicleReservations) {
            Map<String, Object> vrMap = convertVehicleReservationToMap(vr);
            appointmentList.add(vrMap);
        }
        
        logger.info("âœ… [é¢„çº¦æŸ¥è¯¢] åˆå¹¶åæ€»æ•°æ®é‡: {} æ¡", appointmentList.size());
    } catch (Exception e) {
        logger.error("âŒ [é¢„çº¦æŸ¥è¯¢] æŸ¥è¯¢vehicle_reservationè¡¨å¤±è´¥: {}", e.getMessage(), e);
        // å³ä½¿æŸ¥è¯¢å¤±è´¥ï¼Œä¹Ÿè¿”å›appointmentè¡¨çš„æ•°æ®
    }
    
    // è¿”å›åˆå¹¶åçš„æ•°æ®
    HashMap<String, Object> dataMap = new HashMap<>();
    dataMap.put("data", appointmentList);
    return R.ok(dataMap);
}
```

#### 1.3 æ–°å¢æ•°æ®è½¬æ¢æ–¹æ³•

**æ–¹æ³•å**ï¼š`convertVehicleReservationToMap(VehicleReservation vr)`

**ä½ç½®**ï¼šç¬¬ 2424-2521 è¡Œ

**åŠŸèƒ½**ï¼šå°† vehicle_reservation è¡¨çš„æ•°æ®è½¬æ¢ä¸ºä¸ appointment è¡¨ç»Ÿä¸€çš„æ ¼å¼

**å­—æ®µæ˜ å°„è§„åˆ™**ï¼š

| å‰ç«¯å­—æ®µ | vehicle_reservation | è¯´æ˜ |
|---------|-------------------|------|
| `id` | `"vr_" + id` | æ·»åŠ å‰ç¼€åŒºåˆ†æ•°æ®æº |
| `platenumber` | `plate_number` | è½¦ç‰Œå· |
| `visitorname` | `notifier_name` | é€šçŸ¥äººå§“å |
| `community` | `yard_name` | è½¦åœºåç§° |
| `recorddate` | `create_time` | åˆ›å»ºæ—¶é—´ |
| `visitdate` | `appointment_time` | é¢„çº¦æ—¶é—´ |
| `arrivedate` | `enter_time` | è¿›åœºæ—¶é—´ |
| `leavedate` | `leave_time` | ç¦»åœºæ—¶é—´ |
| `ownername` | `merchant_name` | å•†æˆ·åç§° |
| `visitreason` | `release_reason` | æ”¾è¡ŒåŸå›  |
| `refusereason` | `remark` | å¤‡æ³¨ |
| `cartype` | `vehicle_classification` | è½¦è¾†åˆ†ç±» |
| `appointtype` | "åå°å½•å…¥" | å›ºå®šå€¼ï¼Œæ ‡è¯†æ•°æ®æ¥æº |
| `auditstatus` | "å·²é€šè¿‡" | å›ºå®šå€¼ï¼Œåå°å½•å…¥é»˜è®¤å·²é€šè¿‡ |
| `dataSource` | "backend" | æ•°æ®æ¥æºæ ‡è¯† |

**è½¦è¾†çŠ¶æ€è®¡ç®—è§„åˆ™**ï¼š
```java
String venuestatus = "å¾…å…¥åœº";
if (enterTime != null && !enterTime.isEmpty()) {
    if (leaveTime != null) {
        venuestatus = "å·²ç¦»åœº";
    } else {
        venuestatus = "å·²è¿›åœº";
    }
}
```

### 2. å‰ç«¯æ•°æ®å¤„ç†

**æ–‡ä»¶**ï¼š`dataList.vue`ï¼ˆå·²ä¿®å¤å­—æ®µæ˜ å°„é—®é¢˜ï¼‰

å‰ç«¯çš„ `formatAppointmentData()` æ–¹æ³•ä¼šè‡ªåŠ¨å¤„ç†å­—æ®µæ˜ å°„ï¼š
- å°å†™å­—æ®µ â†’ é©¼å³°å­—æ®µ
- æ•°æ®æ¥æºè¯†åˆ«ï¼ˆ`dataSource` å­—æ®µï¼‰

## æ•°æ®æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å°ç¨‹åºæŸ¥è¯¢è¯·æ±‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AppointmentController      â”‚
â”‚  getList() æ¥å£              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ appointment  â”‚  â”‚ vehicle_reservationâ”‚
â”‚ è¡¨æŸ¥è¯¢       â”‚  â”‚ è¡¨æŸ¥è¯¢              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚
       â”‚                   â–¼
       â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚          â”‚ convertVehicleRes..â”‚
       â”‚          â”‚ è½¬æ¢ä¸ºç»Ÿä¸€æ ¼å¼      â”‚
       â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  åˆå¹¶æ•°æ®åˆ—è¡¨     â”‚
        â”‚  æ·»åŠ  dataSource â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  è¿”å›ç»™å‰ç«¯       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## è½¦åœºè¿‡æ»¤è¯´æ˜

### å½“å‰å®ç°
ç›®å‰æ¥å£è¿”å›æ‰€æœ‰æ•°æ®ï¼Œå‰ç«¯åœ¨ `dataList.vue` ä¸­æŒ‰ç®¡å®¶æ‰€å±è½¦åœºè¿›è¡Œè¿‡æ»¤ã€‚

**å‰ç«¯è¿‡æ»¤ä»£ç **ï¼ˆ`loadAppointmentDataForManager` æ–¹æ³•ï¼‰ï¼š
```javascript
// å‰ç«¯æŒ‰å°åŒºç­›é€‰
let filteredData = dataArray
if (managerCommunity) {
    filteredData = dataArray.filter(item => {
        const itemCommunity = (item.community || '').trim()
        const targetCommunity = managerCommunity.trim()
        return itemCommunity === targetCommunity
    })
}
```

### è½¦åœºå­—æ®µå¯¹åº”å…³ç³»
- `appointment` è¡¨ï¼š`community` å­—æ®µ
- `vehicle_reservation` è¡¨ï¼š`yard_name` å­—æ®µï¼ˆè½¬æ¢åæ˜ å°„ä¸º `community`ï¼‰

### è¿‡æ»¤é€»è¾‘
1. ç®¡å®¶ç™»å½•åï¼Œä» `userInfo` ä¸­è·å–æ‰€å±è½¦åœº/å°åŒº
2. æŸ¥è¯¢è·å–æ‰€æœ‰é¢„çº¦æ•°æ®
3. å‰ç«¯æŒ‰ `community` å­—æ®µè¿‡æ»¤ï¼Œåªæ˜¾ç¤ºè¯¥è½¦åœºçš„æ•°æ®
4. ä¸¤ä¸ªæ•°æ®æºçš„æ•°æ®éƒ½ä¼šè¢«ç»Ÿä¸€è¿‡æ»¤

## æ•°æ®æ¥æºæ ‡è¯†

æ¯æ¡æ•°æ®éƒ½åŒ…å« `dataSource` å­—æ®µç”¨äºåŒºåˆ†æ¥æºï¼š
- `"miniprogram"` - å°ç¨‹åºé¢„çº¦
- `"backend"` - åå°å½•å…¥

å‰ç«¯å¯æ ¹æ®æ­¤å­—æ®µï¼š
- æ˜¾ç¤ºä¸åŒçš„æ ‡ç­¾æ ·å¼
- æä¾›ä¸åŒçš„æ“ä½œé€‰é¡¹
- ç»Ÿè®¡åˆ†ææ•°æ®æ¥æº

## æµ‹è¯•å»ºè®®

### 1. åç«¯æµ‹è¯•
```bash
# ç›´æ¥è®¿é—®æ¥å£æŸ¥çœ‹è¿”å›æ•°æ®
GET http://localhost:8080/parking/appointment/getList

# æ£€æŸ¥è¿”å›æ•°æ®ï¼š
# 1. æ˜¯å¦åŒ…å«ä¸¤ä¸ªè¡¨çš„æ•°æ®
# 2. dataSource å­—æ®µæ˜¯å¦æ­£ç¡®
# 3. vehicle_reservation çš„ ID æ˜¯å¦æœ‰ "vr_" å‰ç¼€
```

### 2. å‰ç«¯æµ‹è¯•æ­¥éª¤
1. **ç®¡å®¶æ¨¡å¼æµ‹è¯•**ï¼š
   - ä»¥ç®¡å®¶èº«ä»½ç™»å½•å°ç¨‹åº
   - è¿›å…¥"æŸ¥è¯¢ç»“æœ"é¡µé¢
   - æ£€æŸ¥æ˜¯å¦æ˜¾ç¤ºæœ¬è½¦åœºçš„æ‰€æœ‰é¢„çº¦ï¼ˆåŒ…å«åå°å½•å…¥ï¼‰
   - æ£€æŸ¥ `appointtype` ä¸º"åå°å½•å…¥"çš„è®°å½•æ˜¯å¦æ­£ç¡®æ˜¾ç¤º

2. **æ•°æ®å±•ç¤ºæµ‹è¯•**ï¼š
   - è½¦ç‰Œå·æ˜¯å¦æ­£ç¡®æ˜¾ç¤º
   - è®¿å®¢å§“åï¼ˆé€šçŸ¥äººå§“åï¼‰æ˜¯å¦æ˜¾ç¤º
   - è¿›åœºæ—¶é—´ã€ç¦»åœºæ—¶é—´æ˜¯å¦æ­£ç¡®
   - è½¦è¾†çŠ¶æ€æ˜¯å¦æ­£ç¡®è®¡ç®—

3. **æœç´¢æµ‹è¯•**ï¼š
   - è¾“å…¥åå°å½•å…¥çš„è½¦ç‰Œå·ï¼ŒéªŒè¯èƒ½å¦æœç´¢åˆ°
   - æŒ‰æ—¶é—´ç­›é€‰ï¼ŒéªŒè¯åå°æ•°æ®æ˜¯å¦å‚ä¸ç­›é€‰

4. **æ•°æ®çœ‹æ¿æµ‹è¯•**ï¼š
   - "ä»Šæ—¥æ–°å¢"æ˜¯å¦åŒ…å«åå°å½•å…¥çš„æ•°æ®
   - "æœªå…¥åœº"ã€"å·²è¿›åœº"ç»Ÿè®¡æ˜¯å¦æ­£ç¡®

## æ³¨æ„äº‹é¡¹

### 1. ID å†²çªå¤„ç†
- `appointment` è¡¨çš„ IDï¼šä¿æŒåŸå€¼ï¼ˆæ•°å­—ï¼‰
- `vehicle_reservation` è¡¨çš„ IDï¼šæ·»åŠ å‰ç¼€ `"vr_"`
- å‰ç«¯é€šè¿‡ ID æ“ä½œæ•°æ®æ—¶éœ€è¦åˆ¤æ–­æ•°æ®æ¥æº

### 2. å¿…å¡«å­—æ®µ
`vehicle_reservation` è¡¨ç¼ºå°‘éƒ¨åˆ†å­—æ®µï¼Œå·²è®¾ç½®é»˜è®¤å€¼ï¼š
- `visitorphone`: ""
- `ownerphone`: ""
- `building`: ""
- `units`: ""
- `floor`: ""
- `room`: ""

### 3. æ—¶é—´å­—æ®µæ ¼å¼
- `enter_time` æ˜¯ String ç±»å‹ï¼Œç›´æ¥ä½¿ç”¨
- `appointment_time`ã€`leave_time`ã€`create_time` æ˜¯ Date ç±»å‹ï¼Œéœ€è¦æ ¼å¼åŒ–

### 4. å¼‚å¸¸å¤„ç†
- å¦‚æœ vehicle_reservation è¡¨æŸ¥è¯¢å¤±è´¥ï¼Œä¸å½±å“ appointment è¡¨æ•°æ®çš„è¿”å›
- è½¬æ¢å•æ¡æ•°æ®å¤±è´¥æ—¶è®°å½•æ—¥å¿—ï¼Œç»§ç»­å¤„ç†å…¶ä»–æ•°æ®

## åç»­ä¼˜åŒ–å»ºè®®

### 1. æ€§èƒ½ä¼˜åŒ–
å¦‚æœæ•°æ®é‡å¤§ï¼Œå»ºè®®ï¼š
- åœ¨åç«¯æŒ‰è½¦åœºè¿‡æ»¤åå†è¿”å›
- æ·»åŠ åˆ†é¡µåŠŸèƒ½
- æ·»åŠ ç¼“å­˜æœºåˆ¶

### 2. åŠŸèƒ½å¢å¼º
- æ”¯æŒæŒ‰æ•°æ®æ¥æºç­›é€‰
- åå°å½•å…¥æ•°æ®æ”¯æŒåœ¨å°ç¨‹åºä¸­ç¼–è¾‘
- æ·»åŠ æ•°æ®åŒæ­¥æœºåˆ¶

### 3. ä»£ç ä¼˜åŒ–
- æŠ½å–å­—æ®µæ˜ å°„é…ç½®
- ç»Ÿä¸€æ•°æ®è½¬æ¢é€»è¾‘
- æ·»åŠ å•å…ƒæµ‹è¯•

## ç›¸å…³æ–‡æ¡£

- `vehicle-reservation-integration.md` - å­—æ®µæ˜ å°„è¯¦ç»†è¯´æ˜
- `dataList-field-mapping-fix.md` - å‰ç«¯å­—æ®µæ˜ å°„ä¿®å¤è¯´æ˜

## ä¿®æ”¹æ–‡ä»¶åˆ—è¡¨

1. **åç«¯**ï¼š
   - `d:\PakingDemo\parking-demo\src\main\java\com\parkingmanage\controller\AppointmentController.java`
     - ç¬¬ 71 è¡Œï¼šæ³¨å…¥ VehicleReservationService
     - ç¬¬ 529-615 è¡Œï¼šä¿®æ”¹ getList æ¥å£
     - ç¬¬ 2424-2521 è¡Œï¼šæ–°å¢ convertVehicleReservationToMap æ–¹æ³•

2. **å‰ç«¯**ï¼ˆå·²å®Œæˆï¼‰ï¼š
   - `d:\PakingDemo\car-new-demo-2\car-new-demo\pagesA\reservation\dataList\dataList.vue`
     - å·²ä¿®å¤å­—æ®µæ˜ å°„é—®é¢˜
     - å‰ç«¯ä¼šè‡ªåŠ¨æŒ‰è½¦åœºè¿‡æ»¤æ•°æ®

## æµ‹è¯•æ¸…å•

- [ ] åç«¯ç¼–è¯‘é€šè¿‡
- [ ] getList æ¥å£è¿”å›åˆå¹¶åçš„æ•°æ®
- [ ] åå°å½•å…¥æ•°æ®å­—æ®µæ˜ å°„æ­£ç¡®
- [ ] ç®¡å®¶æŸ¥è¯¢åªæ˜¾ç¤ºæœ¬è½¦åœºæ•°æ®
- [ ] æœç´¢åŠŸèƒ½æ”¯æŒåå°å½•å…¥æ•°æ®
- [ ] æ•°æ®çœ‹æ¿ç»Ÿè®¡åŒ…å«åå°æ•°æ®
- [ ] è½¦è¾†çŠ¶æ€è®¡ç®—æ­£ç¡®
- [ ] æ•°æ®æ¥æºæ ‡è¯†æ­£ç¡®

## å®Œæˆæ—¶é—´

2024-12-12

## å¼€å‘è€…

Cascade AI Assistant
